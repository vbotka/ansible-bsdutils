---

- name: "copy: Test presence of {{ bsdutils_source_dest }}/bsd-utils-current.lock"
  stat:
    path: "{{ bsdutils_source_dest }}/bsd-utils-current.lock"
  register: bsdutils_current_lock

- debug: msg="[LOCK] bsd-utils-current.lock file is present. Scripts will no be copied."
  when:
    - bsdutils_current_lock.stat.exists
    - not bsdutils_source_ignore_current_lock

- name: "copy: Create directory for installation {{ bsdutils_bin_dir }}"
  file:
    state: "directory"
    path: "{{ bsdutils_bin_dir }}"
    owner: "{{ bsdutils_owner }}"
    group: "{{ bsdutils_group }}"
    mode: "{{ bsdutils_bin_dir_mode }}"
  when: (not bsdutils_current_lock.stat.exists) or
        bsdutils_source_ignore_current_lock

- name: "copy: Copy utils to {{ bsdutils_bin_dir }}"
  copy:
    src: "{{ bsdutils_source_dest }}/bsd-utils/{{ item }}"
    dest: "{{ bsdutils_bin_dir }}/{{ item }}"
    remote_src: yes
    owner: "{{ bsdutils_owner }}"
    group: "{{ bsdutils_group }}"
    mode: "{{ bsdutils_bin_mode }}"
  with_items: "{{ bsdutils_copy }}"
  when:
    - (not bsdutils_current_lock.stat.exists) or
      bsdutils_source_ignore_current_lock
    - not ansible_check_mode

# EOF
...
